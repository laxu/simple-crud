var frontend=function(){"use strict";function i(e,t){if(!e)return!1;clearTimeout(n);t=t||"notice";var r=document.getElementById("notification");r.className=t;r.innerHTML=e;r.style.display="block";n=setTimeout(function(){r.style.display="none"},5e3);return!0}function s(e){var t=typeof e=="object"?e:document.getElementById(e);t.style.display=t.style.display!=="none"?"none":""}function o(e,t){var n=document.forms[e],r;for(var i in t){r=n.querySelector("[name="+i+"]");r&&(r.value=t[i])}}function u(e){var t=[],n=2;for(var r in e){if(r==="id")continue;e[r].length<n&&t.push(r)}if(t.length){var s="<p>Error! The following fields are empty or too short:</p><ul>";for(var o=0;o<t.length;o++)s+="<li>"+t[o]+"</li>";s+="</ul>";i(s,"error");return!1}return!0}function a(e){var t=document.forms[e],n=t.getElementsByTagName("input");for(var r=0;r<n.length;r++)n[r].value=""}function f(e,t){var n;if(!e)throw new Error("AJAX error, options object not defined");if(window.XMLHttpRequest){n=new XMLHttpRequest;n.onreadystatechange=function(){n.readyState===4&&typeof t=="function"&&(n.status===200?t(JSON.parse(n.responseText)):i("AJAX error: "+n.status,"error"))};e.method=e.method||"POST";n.open(e.method,e.url,!0);if(e.data){typeof e.data=="object"&&(e.data=JSON.stringify(e.data));n.setRequestHeader("Content-type","application/x-www-form-urlencoded")}n.send(e.data)}}function l(e,t){if(t)for(var n in t){var r=new RegExp("{{"+n+"}}","g");e=e.replace(r,t[n])}return e}function c(){var n=document.getElementById("list"),r=document.getElementById("spinner");s(n);s(r);f({url:"/getClientList"},function(i){s(r);s(n);if(i)if(i.length){var o="";for(var u=0;u<i.length;u++)o+=l(t,i[u]);e.innerHTML=o}else e.innerHTML='<tr><td><p class="notice">No clients. Get some!</p></td><td></td><td></td></tr>';else e.innerHTML='<tr><td><p class="error">Client data could not be loaded</p></td><td></td><td></td></tr>'})}function h(e){e?f({method:"POST",url:"/getClient",data:{id:e}},function(e){if(e&&e._id){e.id=e._id;o("edit-client-form",e);document.getElementById("edit-client-dialog").style.display="block"}else i("Client data not found","error")}):i("No id","error")}function d(e){e.preventDefault();if(!r){r=!0;var t=document.forms["edit-client-form"].getElementsByTagName("input"),n={};for(var o=0;o<t.length;o++){var l=t[o];n[l.getAttribute("name")]=l.value}if(!u(n)){r=!1;return!1}f({url:"/editClient",method:"PUT",data:n},function(e){if(e)if(e.status){s("edit-client-dialog");a("edit-client-form");c();i("Client data saved","success")}else i("Saving client data failed","error");else i("Fatal error when saving client data","error");r=!1})}return!1}var e,t,n,r=!1,p={addClient:function(e){e.preventDefault();a("edit-client-form");document.getElementById("edit-client-dialog").style.display="block"},editClient:function(e){e.preventDefault();var t=e.target.parentElement.parentElement,n=t.getAttribute("data-id");h(n)},removeClient:function(t){t.preventDefault();var n=t.target,r=n.parentElement.parentElement;if(/btn-danger/.test(n.className)){var s={id:r.getAttribute("data-id")};f({url:"/editClient",method:"DELETE",data:s},function(t){if(t.status){r.parentElement.removeChild(r);i("Client removed","success");e.children.length||c()}else{i("Could not remove client","error");n.className=n.className.replace("btn-danger","")}})}else{var o=e.querySelectorAll(".delete-client-button");for(var u=0;u<o.length;u++)o[u].className=o[u].className.replace("btn-danger","");n.className+=" btn-danger"}},closeEditDialog:function(e){e.preventDefault();document.getElementById("edit-client-dialog").style.display="none"}};document.onreadystatechange=function(){if(document.readyState==="complete"){t=document.getElementById("list-item-template").innerHTML;document.getElementById("add-client-button").addEventListener("click",p.addClient,!1);document.getElementById("close-edit-dialog").addEventListener("click",p.closeEditDialog,!1);e=document.getElementById("list-body");e.addEventListener("click",function(e){/edit-client-button/.test(e.target.className)?p.editClient(e):/delete-client-button/.test(e.target.className)&&p.removeClient(e)},!1);document.forms["edit-client-form"].addEventListener("submit",d,!1);c()}};return{notify:i,toggleVisibility:s,ajax:f,fillTemplate:l,fillForm:o,validateFormData:u,updateClientList:c,getClient:h}}();